<!doctype html>



  


<html class="theme-next muse use-motion" lang="chinese & Englishi">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="详细代码可阅读我的github MySQLMySQL基本使用-- 数据库     存储数据，把数据持久化到硬盘  -- RDBMS     关系型数据库系统     用二维表存储数据，一行代表一条数据，每一条数据拥有多个属性     oracle     MySQL     sqlserver     sqlite  -- SQL     在关系型数据库中使用的语言     不区分大小写 SelE">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库">
<meta property="og:url" content="http://yoursite.com/2017/09/10/python数据库/index.html">
<meta property="og:site_name" content="tonytonypeng">
<meta property="og:description" content="详细代码可阅读我的github MySQLMySQL基本使用-- 数据库     存储数据，把数据持久化到硬盘  -- RDBMS     关系型数据库系统     用二维表存储数据，一行代表一条数据，每一条数据拥有多个属性     oracle     MySQL     sqlserver     sqlite  -- SQL     在关系型数据库中使用的语言     不区分大小写 SelE">
<meta property="og:locale" content="chinese & Englishi">
<meta property="og:updated_time" content="2017-09-18T06:57:14.124Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="数据库">
<meta name="twitter:description" content="详细代码可阅读我的github MySQLMySQL基本使用-- 数据库     存储数据，把数据持久化到硬盘  -- RDBMS     关系型数据库系统     用二维表存储数据，一行代表一条数据，每一条数据拥有多个属性     oracle     MySQL     sqlserver     sqlite  -- SQL     在关系型数据库中使用的语言     不区分大小写 SelE">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/09/10/python数据库/"/>





  <title> 数据库 | tonytonypeng </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="chinese & Englishi">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">tonytonypeng</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">For Python learning</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/10/python数据库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiZhanPeng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tonytonypeng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                数据库
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-10T15:14:13+08:00">
                2017-09-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>详细代码可阅读我的<a href="https://github.com/tonytonypeng/Database" target="_blank" rel="external">github</a></p>
<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><h4 id="MySQL基本使用"><a href="#MySQL基本使用" class="headerlink" title="MySQL基本使用"></a>MySQL基本使用</h4><pre><code>-- 数据库
    存储数据，把数据持久化到硬盘

-- RDBMS
    关系型数据库系统
    用二维表存储数据，一行代表一条数据，每一条数据拥有多个属性
    oracle
    MySQL
    sqlserver
    sqlite

-- SQL
    在关系型数据库中使用的语言
    不区分大小写 SelEcT

-- MySQL
    被卖给Sun，Sun被卖给Oracle
    开源、免费
    支持各种操作系统：windows、linux、macos

-- 服务端(Server)
    -- 查询服务是否开启
        ps ajx | grep mysql 看mysqld进程是否存在
    -- 开启服务
        sudo service mysql start
    -- 停止服务
        sudo service mysql stop
    -- 重启服务
        sudo service mysql restart

-- 客户端操作(Client)

  -- navicat(GUI的使用)

  -- 数据完整性
      5.0版本后，数据类型的长度指的是数据显示的宽度
      varchar(10),指的是能放最多10个字符，一个字母或一个数字或一个中文都是一个字符
      int(1),指的是放int类型的数据范围是4个字节的大小，跟设置的长度
      decimal(5,2)表示共存5位数，小数占2位
      列：数据类型、取值范围、是否为空
      行：必须有一个唯一标示，需要有一个主键
      表：引用了另一个表的数据，通过外键约束范围

  -- 终端命令
      -- mysql -uroot -pmysql -u -p 后面都没有空格

      -- 数据库操作
          -- 查看所有数据库
              show databases;
          -- 查看当前使用的数据库
              select database();
          -- 使用某一个数据库
              use py3;
          -- 创建数据库
              create database abc charset=utf8;
          -- 删除数据库
              drop database abc;

      -- 数据表操作
          -- 查看所有表
              show tables;
          -- 查看表结构
              desc class;
          -- 查看表创建的语句
              show create table class;
          -- 创建表
              create table student(
                  id int unsigned primary key not null auto_increment,
                  name varchar(5)
                  );
          -- 添加字段
              alter table student add aeg int;
          -- 修改字段 同时修改名称和类型
              alter table student change aeg age varchar(5);
          -- 修改字段 只修改类型
              alter table student modify age int;
          -- 删除字段
              alter table student drop age;
          -- 删除表
              drop table student;


      -- 数据操作

          -- 查询数据
              select * from class;
              select name from class;
              select name as 名称 from class;
          -- 插入数据 表名后面没有指定列，values 的值需要对应上表所有的字段，顺序也是一致
              insert into student values(1,&apos;嘻嘻嘻&apos;);
              insert into student(name) values(&apos;啊课&apos;);
              insert into student(name) values(&apos;啊课&apos;),(&apos;黄忠&apos;);
          -- 更新数据
              update student set name=&apos;诸葛亮&apos; where id=4;-- 找到id=4的一行数据，把其中的name改为
              update student set name=&apos;诸葛亮&apos;,age=20 where id=4;
              update student set age=18;-- 把每一行的数据中的 age改成18

          -- 删除数据
              delete from student where id=5;-- 删除id为5的那条数据
              delete from student;-- 删除所有的数据

              -- 逻辑删除 在表中添加列，记录数据是否删除 bit(1)
                  alter table student add isdelete bit default 0;
                  -- 想删除数据时
                      update student set isdelete=1 where id=5;
                  -- 查询数据时，只要没有删除的数据
                      select * from student where isdelete=0;

      -- 数据备份和恢复
          -- 备份
              mysqldump -uroot -p py3 &gt; py3.sql

          -- 恢复
              -- 先创建数据库 aaa
              mysql -uroot -p aaa &lt; py3.sql
</code></pre><h4 id="MySQL-查询"><a href="#MySQL-查询" class="headerlink" title="MySQL 查询"></a>MySQL 查询</h4><pre><code>-- 创建表
    create table students(
        id int unsigned primary key auto_increment not null,
        name varchar(20) default &apos;&apos;,
        age tinyint unsigned default 0,
        height decimal(5,2),
        gender enum(&apos;男&apos;,&apos;女&apos;,&apos;人妖&apos;,&apos;保密&apos;),
        cls_id int unsigned default 0,
        isdelete bit default 0
        );
-- 准备数据
    insert into students values
    (0,&apos;小铭&apos;,18,180.00,2,1,0),
    (0,&apos;小月月&apos;,18,180.00,2,2,1),
    (0,&apos;彭于晏&apos;,29,185.00,1,1,0),
    (0,&apos;刘德华&apos;,59,175.00,1,2,1),
    (0,&apos;芙蓉&apos;,38,160.00,2,1,0),
    (0,&apos;凤姐&apos;,28,150.00,4,2,1),
    (0,&apos;王祖贤&apos;,18,172.00,2,1,1),
    (0,&apos;周杰伦&apos;,36,NULL,1,1,0),
    (0,&apos;程坤&apos;,27,181.00,1,2,0),
    (0,&apos;刘亦菲&apos;,25,166.00,2,2,0),
    (0,&apos;金星&apos;,33,162.00,3,3,1),
    (0,&apos;静香&apos;,12,180.00,2,4,0),
    (0,&apos;周杰&apos;,34,176.00,2,5,0);

-- 去除重复结果

    select distinct 列1,... from 表名;
    -- 查询不重复的年龄
    select distinct age from students;
    -- 出现age和height都不重复的数据
    select distinct age,height from students;

-- 条件查询
    select * from 表名 where 条件;

    -- 比较运算符
        -- 查询编号大于3的学生
            select * from students where id &gt; 3;
        -- 查询姓名不是“黄蓉”的学生
            select * from students where name!=&apos;黄蓉&apos;;
            select * from students where name&lt;&gt;&apos;黄蓉&apos;;
    -- 逻辑运算符
        -- 查询编号大于3的女同学
            select * from students where id&gt;3 and gender=&apos;女&apos;;-- gender=2；
        -- 查询编号小于4或没被删除的学生
            select * from students where id &lt; 4 or isdelete=0;
    -- 模糊查询

        % 代表n个字符
        _ 代表一个字符

        -- 查询姓黄的学生
            select * from students where name like &apos;黄%&apos;;
        -- 查询姓黄的学生,而且姓名为两个字
            select * from students where name like &apos;黄_&apos;;

    -- 范围查询

        -- 查询编号是1或3或8的学生
            select * from students where id in(1,3,8); -- not in 取反
        -- 查询年龄在18到28的学生
            select * from students where age between 18 and 28;
    -- 空判断

        -- 查询没有填写身高的学生
            select * from students where height is null;-- is not 取反

-- 排序
    -- 按照年龄排序  倒序 age desc
    select * from students order by age;
    -- 先按年龄正序，在按身高正序
    select * from students order by age,height;

-- 聚合函数

    -- 统计行数
        select count(\*) from students;

        select max(age) as 最大年龄,min(age) as 最小年龄, avg(age) as 平均年龄,sum(age) from students;

-- 分组
    -- 按照某一列分组，select后只能显示那一列，还能统计数据
    select gender,count(\*) from students group by gender;
    -- 根据多列分组
    select age,height,count(\*) from students group by age,height;
    -- 分组后，按条件筛选数据，不能用where，只能用having
    select gender from students group by gender having gender=1;

-- 分页
    -- limit index,num   index 第一天数据为0
    select * from students limit 3,4;-- 从索引3位置开始，查询4条数据  4，5，6，7

-- 表连接

    -- 内连接 学生有班级信息，班级里也与学生
    select * from students as s inner join pythons as p on s.cls_id=p.id;
    -- 左连接 查询所有的学生在哪个班级
    select * from students as a left join pythons as p on a.cls_id=p.id
    -- 右连接 查询所有的班级都有哪些学生
    select * from students as a right join pythons as p on a.cls_id=p.id;


    -- 自关联
        -- 查询广东省的所有市
        select city.atitle,pro.atitle from areas as city inner join areas as pro on city.pid=pro.aid where pro.atitle=&apos;广东省&apos;;

    -- 子查询
        -- 标量子查询 子查询里面返回的就是一个值，一行一列
            -- 查询班级学生的平均身高
            select avg(height) from students;
            -- 查询大于平均身高的学生
            select * from students where height &gt; (select avg(height) from students);

        -- 列级子查询 子查询返回的是一个集合，一列多行

            -- 查询还有学生在班的所有班级名字
                找出学生表中所有的班级 id
                找出班级表中对应的名字
            select * from pythons where id in (select distinct cls_id from students);

        -- 行级子查询 子查询返回的是一行多列的值

            -- 需求: 查找班级年龄最大,身高最高的学生
            select max(age),max(height) from students;
            select * from students where age=59 and height=185.00;
            select * from students where (age,height)=(select max(age),max(height) from students)

        -- 表级子查询 from 后的表是查询处理的表
            查询学生与班级对应的信息
            select * from students as s inner join pythons as p on s.cls_id=p.id;
            select res.stu_name,res.p_name from (select s.name as stu_name,p.name as p_name from students as s inner join pythons as p on s.cls_id=p.id) as res
            -- 按照年龄倒序，前10名中的女生
            select r.* from (select s.* from students as s s.gender=2 order by age desc limit 10)  as r where r.gender=2

    -- 函数
        -- 连接
             select concat(name,&apos;的性别是&apos; ,gender) from students;
        -- 截取
            select left(name,1) from students;
        -- 根据性别显示信息，如果是男，显示x靓仔，女的，x靓女，其他的显示xxx
            select
            case gender
            when 1 then concat(left(name,1),&apos;靓仔&apos;)
            when 2 then concat(left(name,1),&apos;靓女&apos;)
            else concat(left(name,1),&apos;\**&apos;)
            end
            ,name , gender
            from students;

            a = 3 if b==1 else 2
</code></pre><h4 id="查询演练"><a href="#查询演练" class="headerlink" title="查询演练"></a>查询演练</h4><pre><code>-- 求所有电脑产品的平均价格,并且保留两位小数
    select round(avg(price),2) from goods;
-- 查询所有价格大于平均价格的商品，并且按价格降序排序
    select * from goods where price &gt; (select round(avg(price),2) from goods) order by price desc;
-- 查询类型为&apos;超极本&apos;的商品价格
    select * from goods where cate=&apos;超级本&apos;;
-- 查询价格大于或等于&quot;超级本&quot;价格的商品，并且按价格降序排列
    select * from goods where price &gt;=any (select price from goods where cate=&apos;超级本&apos;)
    select * from goods where price not in (select price from goods where cate=&apos;超级本&apos;)

数据分表

-- 创建“商品分类”表
    create table if not exists goods_cates(
        cate_id int unsigned primary key auto_increment,
        cate_name varchar(40)
    );
-- 查询商品中的分类
    select distinct cate from goods；
-- 把分类添加到“商品分类”表
    insert into goods_cates(cate_name) select distinct cate from goods;

-- 创建“商品品牌”表，插入数据
    create table a select * from b;
    create table goods_brands(
        brand_id int unsigned primary key auto_increment not null,
        brand_name varchar(20)
        ) select distinct brand_name from goods;

-- 更新商品表中的分类为商品分类表的id
    select * from goods as g inner join goods_cates as c on g.cate=c.cate_name;
    update goods as g inner join goods_cates as c on g.cate=c.cate_name set g.cate = c.cate_id;

-- 更新商品表中的品牌为品牌分类表的id
    select * from goods as g inner join goods_brands as c on g.brand_name=c.brand_name;
    update goods as g inner join goods_brands as c on g.brand_name=c.brand_name
    set g.brand_name=c.brand_id;

-- 插入数据
        insert into goods (name,cate_id,brand_id,price)
        values(&apos;LaserJet Pro P1606dn 黑白激光打印机&apos;,&apos;12&apos;,&apos;4&apos;,&apos;1849&apos;);
        insert into goods_cates(cate_name) values (&apos;路由器&apos;),(&apos;交换机&apos;),(&apos;网卡&apos;);
        insert into goods_brands(brand_name) values (&apos;海尔&apos;),(&apos;清华同方&apos;),(&apos;神舟&apos;);

-- 查询商品的信息，包括商品类型和商品品牌
    select g.name,c.cate_name,b.brand_name from goods as g
    inner join goods_cates as c on g.cate_id=c.cate_id
    inner join goods_brands as b on g.brand_id=b.brand_id

-- 左连接，查询所有商品对应的类型和品牌
    select g.name,c.cate_name,b.brand_name from goods as g
    left join goods_cates as c on g.cate_id=c.cate_id
    left join goods_brands as b on g.brand_id=b.brand_id

-- 右连接，查询所有商品类型和品牌对应的商品信息
    select g.name,c.cate_name,b.brand_name from goods as g
    right join goods_cates as c on g.cate_id=c.cate_id
    right join goods_brands as b on g.brand_id=b.brand_id

-- 外键 必须保证此表的列和引用的列类型一致（符号问题）   约束插入或更新时，某一列的值的范围，外键指向的是另一个表的某一列
    alter table goods add FOREIGN KEY goods_1(cate_id) REFERENCES goods_cates(cate_id);
    alter table goods add FOREIGN KEY goods_2(brand_id) REFERENCES goods_brands(brand_id);
    影响插入和更新的效率

-- 删除外键
        使用show create table goods , 查看CONSTRAINT
        alter table goods drop foreign key goods_ibfk_1;

      创建外键时，mysql自动在那一列创建了索引，删除外键时不会自动删除，需要手动删除

        alter table goods dorp index goods;
</code></pre><h4 id="MySQL高级"><a href="#MySQL高级" class="headerlink" title="MySQL高级"></a>MySQL高级</h4><pre><code>--账户管理

  -- 账户管理是在mysql仓库中
  -- user表记录了所有的账户信息

  -- 创建账户并授权

      语法如下：
      grant 权限列表 on 数据库 to &apos;用户名&apos;@&apos;访问主机&apos; identified by &apos;密码&apos;;

      grant all privileges on py3.* to &apos;py3&apos;@&apos;%&apos; identified by &apos;123&apos;;

  -- 回收权限

      revoke 权限列表 on 数据库名.* from  &apos;用户名&apos;@&apos;主机&apos;;

      revoke select on py3.* from &apos;py3&apos;@&apos;%&apos;;

  -- 修改密码 自己修改自己的密码

      语法1：不需登录
      mysqladmin -u py -p password &apos;新密码&apos;

      mysqladmin -upy3 -p password &apos;123456&apos;; -- 回车后输入原来的密码

  -- 语法2：使用root登录，修改mysql数据库的user表
      使用password()函数进行密码加密
      注意修改完成后需要刷新权限

      update user set authentication_string=password(&apos;123&apos;) where user=&apos;py3&apos;;

      flush privileges

  -- 删除账户

      语法1：使用root登录
      drop user &apos;用户名&apos;@&apos;主机&apos;;
      drop user &apos;py3&apos;@&apos;%&apos;;

      -- 语法2：使用root登录，删除mysql数据库的user表中数据
          delete from user where user=&apos;用户名&apos;;
          例：
          delete from user where user=&apos;py&apos;;

          -- 操作结束之后需要刷新权限
          flush privileges

  -- root账户忘记密码
      -- 1、配置数据库登录是不需要密码
          /etc/mysql/mysql.conf.d/mysqld.cnf
          在[mysqld]后面添加 skip-grant-tables
          重启数据库
      -- 2、登录数据库，修改密码

          mysql -uroot
          update user set authentication_string=password(&apos;123&apos;) where user=&apos;root&apos;;

      -- 3、配置登录需要密码
          skip-grant-tables去掉

          name = &apos;uo1241&apos;

          insert into xxx values(&apos;name&apos;,,,);
          zu000&apos;,,); drop database xx;
          insert into xxx values(&apos;zu000&apos;,,); drop database xx;&apos;,,,);
-- 函数
    -- 创建

      只能调用select into 语句
      select avg(age) into res from students;

      语法如下
      delimiter $$
      create function 函数名称(参数列表) returns 返回类型
      begin
      sql语句
      end
      $$
      delimiter ;


      delimiter $$
      create function my_trim(str varchar(10)) returns varchar(10)
      begin
      return rtrim(ltrim(str))
      end
      $$
      delimiter ;

  -- 调用

      select my_trim(&apos;  abc   &apos;);

  -- 变量
      临时变量，只能用在 begin end 之间
      declare i int default 0
      set i = 5

      用户变量/会话变量
      set @age=20
      select @age:=avg(age) from students;
      select @age

      系统变量
      set @@wait_timeout = 1000
      select @@wait_timeout

      set global wait_timeout =2000
      select @@global.wait_timeout

  -- 函数示例

      要求：定义函数odd，输出1-100间的偶数

      delimiter $$
      create function odd() returns varchar(300)
      begin
      declare i int default 1;
      declare res varchar default &apos;&apos;;
      while i&lt;=100 do
          if i%2=0 then
          concat(res,&apos;,&apos;,i);
          end if;
          i = i+1;
      end while;
      return res;
      end
      $$
      delimiter ;

-- 存储过程

    语法如下
    delimiter //
    create procedure 存储过程名称(in i int,out res varchar(30))
    begin
    sql语句
    end
    //
    delimiter ;

    delimiter //
    create procedure select_stu()
    begin
    select * from students;
    end
    //
    delimiter ;

-- 视图
    create view 视图名称 as select语句;

    create view stu_view as select s.name as 姓名,p.name as &apos;班级&apos; from students as s inner join pythons as p on s.cls_id = p.id;

-- 事物

    500 a 消费 200  a女 消费 100

    update set account=account-200

    update set account=account-100

  -- 提交
      -- 客户端1
          begin -- 开启事物

          insert into pythons(name) values(&apos;python7&apos;);

          查询可以看到数据

      -- 客户端2
          查询看不到数据

      -- 客户端1
          commit

      -- 客户端2
          查询看不到数据

  -- 回滚
      -- 客户端1
          begin -- 开启事物

          insert into pythons(name) values(&apos;python7&apos;);

          查询可以看到数据

      -- 客户端2
          查询看不到数据

      -- 客户端1
          rollback
          查询看到的是以前的数据

      -- 客户端2
          查询看不到数据

-- 索引

    创建索引
    如果指定字段是字符串，需要指定长度，建议长度与定义字段时的长度一致
    字段类型如果不是字符串，可以不填写长度部分
    create index 索引名称 on 表名(字段名称(长度))
    create index name_index on students(name(20))
    create index age_index on students(age)

    一般创建时，看那一列经常被用在where后面，在此列创建索引，优化查询效率
</code></pre><h3 id="Mongo"><a href="#Mongo" class="headerlink" title="Mongo"></a>Mongo</h3><h4 id="mongodb-服务端"><a href="#mongodb-服务端" class="headerlink" title="mongodb 服务端"></a>mongodb 服务端</h4><p>  [{_id:124124,name:’小王’,age:18,chengji:{}},{_id:124124,name:’小王’,age:18,chengji:{}}]<br>  json</p>
<pre><code>-- 开启服务
sudo service mongod start

-- 停止服务
sudo service mongod stop

-- 重启服务
sudo service mongod restart
</code></pre><h4 id="命令行客户端"><a href="#命令行客户端" class="headerlink" title="命令行客户端"></a>命令行客户端</h4><pre><code>-- 登录
mongo

进入后连接点是test仓库

-- 不需要创建仓库，直接use，如果仓库里面没有数据，不会创建
</code></pre><h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><pre><code>-- 创建集合
db.createCollection(name, options)

db.createCollection(&apos;student&apos;)

-- 查看当前数据库的集合
show collections

-- 删除命令  仓库里面没有数据时，会自动删除仓库
db.集合名称.drop()

db.student.drop()

-- 插入 如果集合不存在，自动创建

    语法
    db.集合名称.insert(document)

    db.stu.insert({name:&apos;百里守约&apos;,age:20})

-- 简单查询

    语法
    db.集合名称.find()
    db.stu.find()

    db.stu.find({name:&apos;百里守约&apos;}) 相当于sql中的where

-- 更新

    语法
    db.集合名称.update(
        &lt;query&gt; ,&lt;update&gt;,{multi: &lt;boolean&gt;}
    )
    参数query:查询条件，类似sql语句update中where部分
    参数update:更新操作符，类似sql语句update中set部分
    参数multi:可选，默认是false，表示只更新找到的第一条记录，值为true表示把满足条件的文档全部更新

    db.stu.update({name:&apos;百里守约&apos;},{name:&apos;百里玄策&apos;}) -- 根据条件查找到一个文档，更新成新的文档


    指定属性更新，通过操作符$set  如更新的字段不存在，会新添加这个字段
    db.stu.update({name:&apos;百里玄策2&apos;},{$set:{name:&apos;百里守约&apos;}})


    删除某个文档的字段
    db.stu.update({name:&apos;百里守约&apos;},{$unset:{name:&apos;&apos;}})


    更新多条记录
    db.stu.update({age:20},{$set:{age:30}}) -- 不写multi 只更新结果的第一条

    db.stu.update({age:20},{$set:{age:30}},{multi:true})

-- 删除

    语法
    db.集合名称.remove(
        &lt;query&gt;,{justOne: &lt;boolean&gt;}
    )
    参数query:可选，删除的文档的条件
    参数justOne:可选，如果设为true或1，则只删除一条，默认false，表示删除多条


    db.stu.remove({name:&apos;百里守约&apos;})


-- 创建集合，指定大小 内部会针对size计算，结果是256字节的整数倍

    添加数据超出size，会把第一条数据删除

    db.createCollection(&apos;sub&apos;,{capped:true,size:10})

    db.sub.insert({title:&apos;linux&apos;,count:10})
    db.sub.insert({title:&apos;linux1&apos;,count:10})
    db.sub.insert({title:&apos;linux2&apos;,count:10})
    db.sub.insert({title:&apos;linux3&apos;,count:10})
    db.sub.insert({title:&apos;linux4&apos;,count:10})
</code></pre><h4 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h4><pre><code>-- 基本查询

    方法find()：查询
    db.集合名称.find({条件文档})
    方法findOne()：查询，只返回第一个
    db.集合名称.findOne({条件文档})
    方法pretty()：将结果格式化
    db.集合名称.find({条件文档}).pretty()


  -- 比较运算符

      等于，默认是等于判断，没有运算符
      小于$lt  less than
      小于或等于$lte less than equals
      大于$gt great than
      大于或等于$gte great than equals
      不等于$ne not equals
      例1：查询名称等于&apos;郭靖&apos;的学生

      db.stu.find({name:&apos;郭靖&apos;})

      -- 查询年龄小于30岁
      db.stu.find({age:{$lt:30}})
      db.stu.find({age:{$lte:20}})

      -- 查询不等于18岁
      db.stu.find({age:{$ne:20}})

  -- 逻辑运算符

      查询时可以有多个条件，多个条件之间需要通过逻辑运算符连接
      逻辑与：默认是逻辑与的关系

      -- 查询18的男生
      db.stu.find({age:18,gender:true})

      -- 查询18的学生或者家乡为大理的学生
      db.stu.find({$or:[{age:18},{hometown:&apos;大理&apos;}]})


      例3：查询年龄大于或等于18，并且性别为true的学生
      db.stu.find({
          $or:[{age:{$gt:18}},{age:18}],
          gender:true
      })


  -- 范围运算符

      使用&quot;$in&quot;，&quot;$nin&quot; 判断是否在某个范围内
      例6：查询年龄为18、28的学生

      db.stu.find({age:{$in:[18,20]}})

      db.stu.find({age:{$nin:[18,20]}})


  -- 支持正则表达式

      mongodb提供的终端shell，同时也是一个js的执行器，可以编写js的代码和函数
      使用//或$regex编写正则表达式
      例7：查询姓黄的学生
      db.stu.find({name:/黄/})
      db.stu.find({name:{$regex:&apos;^黄&apos;}})



  -- 自定义查询

      使用$where后面写一个函数，返回满足条件的数据
      例7：查询年龄大于30的学生

      db.stu.find({
          $where:function(){

              return this.age&gt;30;
          }
      })



      -- Limit

          方法limit()：用于读取指定数量的文档
          语法：
          db.集合名称.find().limit(NUMBER)

          -- 查询前2条数据
          db.stu.find().limit(2)

      -- skip

          方法skip()：用于跳过指定数量的文档
          语法：
          db.集合名称.find().skip(NUMBER)

          -- 跳过前2条，查询剩下的数据
          db.stu.find().skip(2)

          db.stu.find().limit(3).skip(3)
          db.stu.find().skip(3).limit(3)


  -- 投影

      在查询到的返回结果中，只选择必要的字段，而不是选择一个文档的整个字段
      如：一个文档有5个字段，需要显示只有3个，投影其中3个字段即可
      语法：
      参数为字段与值，值为1表示显示，值为0不显示
      db.集合名称.find({},{字段名称:1,...})

      db.stu.find({},{name:1,hometown:1})

  -- 指定不显示id

      db.stu.find({},{name:1,hometown:1,\_id:0})


  -- 排序

      方法sort()，用于对结果集进行排序
      语法
      db.集合名称.find().sort({字段:1,...})
      参数1为升序排列
      参数-1为降序排列
      例1：根据性别降序，再根据年龄升序

      db.stu.find().sort({age:1,gender:1})

  -- 统计个数

      方法count()用于统计结果集中文档条数
      语法
      db.集合名称.find({条件}).count()

      db.stu.find().count()或db.stu.count()

      db.stu.find({gender:true}).count() 或 db.stu.count({gender:true})



  -- 消除重复

      方法distinct()对数据进行去重
      语法
      db.集合名称.distinct(&apos;去重字段&apos;,{条件})
      例:查找年龄大于18的学生，来自哪些省份

      db.stu.distinct(&apos;hometown&apos;,{age:{$gt:18}})
</code></pre><h4 id="聚合-aggregate"><a href="#聚合-aggregate" class="headerlink" title="聚合 aggregate"></a>聚合 aggregate</h4><pre><code>--
        聚合(aggregate)主要用于计算数据，类似sql中的sum()、avg()
        语法
        db.集合名称.aggregate({管道:{表达式}})

        $group

        将集合中的文档分组，可用于统计结果
        \_id表示分组的依据，使用某个字段的格式为&apos;$字段&apos;
        例1：统计男生、女生的总人数

        db.stu.aggregate(
            {
                $group:
                {
                    \_id:&apos;$gender&apos;,
                    count:{$sum:1}
                }
            }
        )
        按照性别分组，求每组的年龄总数
        db.stu.aggregate( { $group: { \_id:&apos;$gender&apos;, count:{$sum:&apos;$age&apos;} } } )

        按照性别分组，求每组的平均年龄
        db.stu.aggregate( { $group: { \_id:&apos;$gender&apos;, count:{$avg:&apos;$age&apos;} } } )

        按照性别分组，把年龄组成数组
        db.stu.aggregate( { $group: { \_id:&apos;$gender&apos;, count:{$push:&apos;$name&apos;} } } )

        按照性别分组，把整个文档组成数组
        db.stu.aggregate( { $group: { \_id:&apos;$gender&apos;, count:{$push:&apos;$$ROOT&apos;} } } )


    --Group by null

        将集合中所有文档分为一组
        例2：求学生总人数、平均年龄
        db.stu.aggregate(
            {$group:
                {
                    \_id:null,
                    counter:{$sum:1},
                    avgAge:{$avg:&apos;$age&apos;}
                }
            }
        )

    -- $match

        用于过滤数据，只输出符合条件的文档
        使用MongoDB的标准查询操作
        例1：查询年龄大于20的学生
        db.stu.aggregate({
            $match:{age:{$gt:20}}
        }
        )

        例2：查询年龄大于20的男生、女生人数
        db.stu.aggregate(
            {$match:{age:{$gt:20}}},
            {$group:{_id:&apos;$gender&apos;,counter:{$sum:1}}}
        )


    -- $project

        修改输入文档的结构，如重命名、增加、删除字段、创建计算结果
        例1：查询学生的姓名、年龄

        db.stu.aggregate(
            {
                $project:{name:1,age:1,\_id:0}
            }
        )

    -- 分组后再投影
        db.stu.aggregate(
            {$group: { \_id:&apos;$gender&apos;, count:{$avg:&apos;$age&apos;} }},
            {$project:{count:1,\_id:0}}
        )

    -- $sort

        将输入文档排序后输出
        例1：查询学生信息，按年龄升序
        db.stu.aggregate({$sort:{age:1}})


    -- $skip

        跳过指定数量的文档，并返回余下的文档
        例2：查询从第3条开始的学生信息
        db.stu.aggregate({$skip:2})
        例3：统计男生、女生人数，按人数升序，取第二条数据

        db.stu.aggregate(
            {$group:{_id:&apos;$gender&apos;,counter:{$sum:1}}},
            {$sort:{counter:1}},
            {$skip:1},
            {$limit:1}
        )
        注意，必须先skip，再limit

    -- $unwind

        将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值
        语法1

        对某字段值进行拆分
        db.集合名称.aggregate({$unwind:&apos;$字段名称&apos;})

        db.t2.insert({_id:1,item:&apos;t-shirt&apos;,size:[&apos;S&apos;,&apos;M&apos;,&apos;L&apos;]})

        db.t2.aggregate(
            {$unwind:
                {path:&apos;$size&apos;,
                preserveNullAndEmptyArrays:true
                }
            }
        )
</code></pre><h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><pre><code>--
    创建组合索引时，(a,b,c)
    只要查询条件包含了组合索引的第一个字段，都能用到此索引
    (a) (a,b) (b,a) (a,c) (c,a) (a,b,c) (a,c,b) (b,a,c) (b,c,a) (c,a,b) (c,b,a)

    建立唯一索引，实现唯一约束的功能，要求当前字段中不能有重复的数据
    db.t1.ensureIndex({&quot;name&quot;:1},{&quot;unique&quot;:true})

-- 备份

    语法
    mongodump -h dbhost -d dbname -o dbdirectory
    -h：服务器地址，也可以指定端口号
    -d：需要备份的数据库名称
    -o：备份的数据存放位置，此目录中存放着备份出来的数据

    mongodump -d python -o ~/Desktop/mongodbback/

-- 恢复

    语法
    mongorestore -h dbhost -d dbname --dir dbdirectory
    -h：服务器地址
    -d：需要恢复的数据库实例
    --dir：备份数据所在位置

    mongorestore -d python2 --dir ~/Desktop/mongodbback/python

-- 用户管理
    1、创建超级管理员
    use admin

    db.createUser(
        {
           user: &apos;admin&apos;,
           pwd: &apos;123&apos;,
           roles:[{role:&apos;root&apos;,db:&apos;admin&apos;}]
        }
    )
    2、开启认证
      sudo vi /etc/mongod.conf
      security:
          authorization: enabled
      重启mongdb服务

    3、使用认证某个数据方式终端连接
      mongo -u admin -p 123 --authenticationDatabase admin  --（最后的admin代表连接到某一个数据库）


  -- 普通用户管理

      使用超级管理员登录,然后进入用户管理操作
      进入到某一个仓库，修改当前仓库的用户，查看当前数据库的用户

      db.createUser(
        {
             user: &apos;py&apos;,
             pwd: &apos;123&apos;,
             roles:[{role:&apos;readWrite&apos;,db:&apos;python2&apos;}]
          }
      )
      指定用户的权限在python2仓库，创建此用户时需要先进入python2

      # 修改密码
      db.updateUser(&apos;py&apos;,{pwd: &apos;456&apos;})
      # 修改属性
      db.updateUser(&apos;py&apos;,{roles:[{role:&apos;read&apos;,db:&apos;python2&apos;}]})

-- Redis

    显示中文redis-cli --raw
</code></pre>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/01/python数据结构与算法/" rel="next" title="数据结构与算法学习">
                <i class="fa fa-chevron-left"></i> 数据结构与算法学习
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Inhaltsverzeichnis
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Übersicht
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="LiZhanPeng" />
          <p class="site-author-name" itemprop="name">LiZhanPeng</p>
           
              <p class="site-description motion-element" itemprop="description">For Python learning</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL"><span class="nav-number">1.</span> <span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL基本使用"><span class="nav-number">1.1.</span> <span class="nav-text">MySQL基本使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-查询"><span class="nav-number">1.2.</span> <span class="nav-text">MySQL 查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询演练"><span class="nav-number">1.3.</span> <span class="nav-text">查询演练</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL高级"><span class="nav-number">1.4.</span> <span class="nav-text">MySQL高级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mongo"><span class="nav-number">2.</span> <span class="nav-text">Mongo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mongodb-服务端"><span class="nav-number">2.1.</span> <span class="nav-text">mongodb 服务端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命令行客户端"><span class="nav-number">2.2.</span> <span class="nav-text">命令行客户端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基本操作"><span class="nav-number">2.3.</span> <span class="nav-text">基本操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据查询"><span class="nav-number">2.4.</span> <span class="nav-text">数据查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#聚合-aggregate"><span class="nav-number">2.5.</span> <span class="nav-text">聚合 aggregate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#索引"><span class="nav-number">2.6.</span> <span class="nav-text">索引</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiZhanPeng</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
